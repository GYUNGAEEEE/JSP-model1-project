# MVC 패턴
## JSP에서 MVC 패턴 흐름
![image](https://github.com/GYUNGAEEEE/WebProgramming/assets/158580466/d535348f-a9d3-4c1c-a49c-4cf9a34d752d)

웹 브라우저에서 요청이 서버에 도달하면, 서버는 해당 요청에 대한 처리를 담당할 Setvlet(컨트롤러)를 생성한다.
Servlet은 요청을 분석하여 수행해야 하는 기능을 확인하고, 이를 위해 모델을 활용하여 비즈니스 로직을 처리한다.

모델은 컨트롤러로부터 요청을 받아 해당 기능의 처리를 수행하며, 필요한 경우 외부 자원(예: 데이터베이스)을 사용하여 데이터를 가져올 수 있다.
모델은 처리 결과를 생성하고, 이를 컨트롤러에 반환한다.

컨트롤러는 처리 결과를 클라이언트에 보여주기 위해 JSP 파일을 활용한다. 컨트롤러에서는 JSP 파일에 전달할 데이터를 설정한 후, 해당 JSP 파일을 호출한다.
설정된 데이터는 주로 request나 session 객체에 저장되며, JSP 파일에서는 이 데이터를 활용하여 동적인 HTML을 생성한다. JSP 파일은 Tomcat에서 처음 요청 시에 컴파일되고, 이후에는 컴파일된 서블릿을 사용한다.
서블릿 객체는 초기화(init()) 과정을 거친 후 request나 session 객체에 저장된 데이터를 활용하여 응답 HTML 문서를 생성하고 클라이언트 측으로 응답해준다.

참고로 REST API를 사용하는 경우 JSON 또는 XML 형식으로 데이터를 클라이언트에 응답한다.
***
## JSP에서 MVC패턴을 구현하는 방법
1. 서비스하는 기능마다 서블릿을 정의하고 등록 -> 요청마다 서블릿을 만들고 매핑되는 URL패턴을 설정
   
클라이언트에서 서버로 'A'라는 기능을 요청한다면, 그 'A'기능을 처리하기 위한 서블릿이 있다. 또, 다른 기능에 대한 요청을 한다면 그 요청을 받아주는 서블릿이 있는, 서블릿이 계속 등록이 되는 방식이다.

2. FrontController를 만들어 모든 요청을 받는 서블릿을 정의하고 등록

URL매핑에 /를 이용하여 하나의 서블릿이 모든 요청을 받는다. 즉, 어떤 URL 패턴으로 요청이 들어오는지 상관없이 하나의 서블릿에서 다 받아들인다.   
요청 URL 또는 파라미터로 전달된 명령을 이용하여 처리할 비즈니스 로직을 선택한다. 명령에 따라 특정 Service(Action, Handler, Process)에서 처리를 할 수 있도록 제어를 한다. Service는 회원가입, 로그인, 게시판 등의 기능(비즈니스 로직)과 관련된다.
이들과 DB의 연동을 위한 DAO, DTO도 함께 활용할 수 있다.
FrontController에서 요청을 분석하고 비즈니스 로직을 처리 후 브라우저에 응답 또는 적절한 뷰를 선택하여 응답한다.
***
## FrontController패턴으로 MVC 적용해보기
### 모델 개념 준비
- AddService.java
```java
package exammvc.model;

public class AddService {
	public int add(int n1, int n2) {
		return n1 + n2;
	}
}
```
- MinService.java
```java
package exammvc.model;

public class MinService {
	public int min(int n1, int n2) {
		return n1 - n2;
	}
}
```

### 핸들러 개념 준비
- CommandHandler.java
```java
package exammvc.controller;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

public interface CommandHandler {

	public String handlerAction(
			HttpServletRequest request, 
			HttpServletResponse response) throws ServletException, IOException;
}
```
- AddHandler.java
```java
package exammvc.controller;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import exammvc.model.AddService;

public class AddHandler implements CommandHandler{
	
	private AddService addService = new AddService();

	@Override
	public String handlerAction(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		int n1 = Integer.parseInt(request.getParameter("n1"));
		int n2 = Integer.parseInt(request.getParameter("n2"));
		
		int result = addService.add(n1, n2);
		
		request.setAttribute("result", result);
		
		return "/WEB-INF/add.jsp";
	}
	
}
```
- MinHandler.java
```java
package exammvc.controller;

import java.io.IOException;

import javax.servlet.ServletException;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;

import exammvc.model.MinService;

public class MinHandler implements CommandHandler{
	
	private MinService minService = new MinService();

	@Override
	public String handlerAction(HttpServletRequest request, HttpServletResponse response)
			throws ServletException, IOException {
		int n1 = Integer.parseInt(request.getParameter("n1"));
		int n2 = Integer.parseInt(request.getParameter("n2"));
		
		int result = minService.min(n1, n2);
		
		request.setAttribute("result", result);
		
		return "/WEB-INF/min.jsp";
	}
	
}
```
